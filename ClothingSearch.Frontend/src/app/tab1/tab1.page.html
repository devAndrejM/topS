<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      {{ 'TABS.SEARCH' | translate }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ 'TABS.SEARCH' | translate }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Search Section -->
  <ion-card>
    <ion-card-content>
      <div class="search-container">
        <ion-searchbar
          [(ngModel)]="searchQuery"
          [placeholder]="'SEARCH.PLACEHOLDER' | translate"
          (ionInput)="onSearch()"
          debounce="500">
        </ion-searchbar>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Categories Section -->
  <div *ngIf="searchResults && searchResults.categories.length > 0" class="categories-section">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Kategorije</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-chip 
          *ngFor="let category of searchResults.categories"
          [color]="selectedCategory === category.name ? 'primary' : 'medium'"
          (click)="onCategorySelect(category.name)">
          <ion-label>{{ category.name }} ({{ category.count }})</ion-label>
        </ion-chip>
        <ion-chip 
          *ngIf="selectedCategory"
          color="danger"
          (click)="clearCategory()">
          <ion-icon name="close"></ion-icon>
          <ion-label>Ukloni filter</ion-label>
        </ion-chip>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Results Info -->
  <div *ngIf="searchResults" class="results-info">
    <ion-item>
      <ion-label>
        <h3>{{ searchResults.totalResults }} rezultata pronađeno</h3>
        <p>
          {{ getTimeAgo(searchResults.lastUpdated) }}
          <ion-chip *ngIf="searchResults.isFromCache" color="warning" size="small">
            <ion-label>Iz cache memorije</ion-label>
          </ion-chip>
        </p>
      </ion-label>
    </ion-item>
  </div>

  <!-- Products Grid -->
  <div *ngIf="searchResults && searchResults.products.length > 0" class="products-grid">
    <ion-grid>
      <ion-row>
        <ion-col size="12" size-md="6" size-lg="4" *ngFor="let product of searchResults.products">
          <ion-card class="product-card" (click)="openProduct(product)">
            <img [src]="product.imageUrl" [alt]="product.name" class="product-image" />
            
            <ion-card-header>
              <ion-card-subtitle>{{ product.brand }} • {{ product.storeName }}</ion-card-subtitle>
              <ion-card-title class="product-title">{{ product.name }}</ion-card-title>
            </ion-card-header>

            <ion-card-content>
              <div class="price-section">
                <h2 class="price">{{ formatPrice(product.price, product.currency) }}</h2>
                <ion-chip [color]="product.inStock ? 'success' : 'danger'" size="small">
                  <ion-label>{{ product.inStock ? 'Dostupno' : 'Nedostupno' }}</ion-label>
                </ion-chip>
              </div>

              <p class="description">{{ product.description }}</p>

              <div class="sizes-section" *ngIf="product.sizes.length > 0">
                <ion-label class="sizes-label">Veličine:</ion-label>
                <div class="sizes-container">
                  <ion-chip 
                    *ngFor="let size of product.sizes.slice(0, 5)" 
                    color="light" 
                    size="small">
                    <ion-label>{{ size }}</ion-label>
                  </ion-chip>
                  <span *ngIf="product.sizes.length > 5" class="more-sizes">
                    +{{ product.sizes.length - 5 }} više
                  </span>
                </div>
              </div>

              <ion-button 
                expand="block" 
                fill="solid" 
                color="primary"
                class="buy-button">
                <ion-icon name="open-outline" slot="start"></ion-icon>
                Pogledaj proizvod
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>

  <!-- No Results -->
  <div *ngIf="searchResults && searchResults.products.length === 0" class="no-results">
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-icon name="search-outline" size="large" color="medium"></ion-icon>
        <h2>Nema rezultata</h2>
        <p>Pokušajte s drugim pojmom za pretraživanje</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading && !searchResults" class="loading-section">
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Pretražujem trgovine...</p>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
